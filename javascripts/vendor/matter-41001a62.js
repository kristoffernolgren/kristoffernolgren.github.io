/**
 * The MIT License (MIT)
 *
 * Copyright (c) 2014 Liam Brummitt
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
!function(){var e={},t={};!function(){t._inertiaScale=4;var e=1,n=-1,o=1;t.create=function(e){var t={id:f.nextId(),type:"body",label:"Body",parts:[],angle:0,vertices:P.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,sprite:{xScale:1,yScale:1},lineWidth:1.5}},n=f.extend(t,e);return i(n,e),n},t.nextGroup=function(t){return t?n--:e++},t.nextCategory=function(){return o<<=1};var i=function(e,n){t.set(e,{bounds:e.bounds||A.create(e.vertices),positionPrev:e.positionPrev||M.clone(e.position),anglePrev:e.anglePrev||e.angle,vertices:e.vertices,parts:e.parts||[e],isStatic:e.isStatic,isSleeping:e.isSleeping,parent:e.parent||e}),P.rotate(e.vertices,e.angle,e.position),w.rotate(e.axes,e.angle),A.update(e.bounds,e.vertices,e.velocity),t.set(e,{axes:n.axes||e.axes,area:n.area||e.area,mass:n.mass||e.mass,inertia:n.inertia||e.inertia});var o=e.isStatic?"#eeeeee":f.choose(["#556270","#4ECDC4","#C7F464","#FF6B6B","#C44D58"]),i=f.shadeColor(o,-20);e.render.fillStyle=e.render.fillStyle||o,e.render.strokeStyle=e.render.strokeStyle||i};t.set=function(e,n,o){var i;"string"==typeof n&&(i=n,n={},n[i]=o);for(i in n)if(o=n[i],n.hasOwnProperty(i))switch(i){case"isStatic":t.setStatic(e,o);break;case"isSleeping":h.set(e,o);break;case"mass":t.setMass(e,o);break;case"density":t.setDensity(e,o);break;case"inertia":t.setInertia(e,o);break;case"vertices":t.setVertices(e,o);break;case"position":t.setPosition(e,o);break;case"angle":t.setAngle(e,o);break;case"velocity":t.setVelocity(e,o);break;case"angularVelocity":t.setAngularVelocity(e,o);break;case"parts":t.setParts(e,o);break;default:e[i]=o}},t.setStatic=function(e,t){for(var n=0;n<e.parts.length;n++){var o=e.parts[n];o.isStatic=t,t&&(o.restitution=0,o.friction=1,o.mass=o.inertia=o.density=1/0,o.inverseMass=o.inverseInertia=0,o.positionPrev.x=o.position.x,o.positionPrev.y=o.position.y,o.anglePrev=o.angle,o.angularVelocity=0,o.speed=0,o.angularSpeed=0,o.motion=0)}},t.setMass=function(e,t){e.mass=t,e.inverseMass=1/e.mass,e.density=e.mass/e.area},t.setDensity=function(e,n){t.setMass(e,n*e.area),e.density=n},t.setInertia=function(e,t){e.inertia=t,e.inverseInertia=1/e.inertia},t.setVertices=function(e,n){e.vertices=n[0].body===e?n:P.create(n,e),e.axes=w.fromVertices(e.vertices),e.area=P.area(e.vertices),t.setMass(e,e.density*e.area);var o=P.centre(e.vertices);P.translate(e.vertices,o,-1),t.setInertia(e,t._inertiaScale*P.inertia(e.vertices,e.mass)),P.translate(e.vertices,e.position),A.update(e.bounds,e.vertices,e.velocity)},t.setParts=function(e,n,o){var i;for(n=n.slice(0),e.parts.length=0,e.parts.push(e),e.parent=e,i=0;i<n.length;i++){var s=n[i];s!==e&&(s.parent=e,e.parts.push(s))}if(1!==e.parts.length){if(o="undefined"!=typeof o?o:!0){var a=[];for(i=0;i<n.length;i++)a=a.concat(n[i].vertices);P.clockwiseSort(a);var l=P.hull(a),c=P.centre(l);t.setVertices(e,l),P.translate(e.vertices,c)}var d=r(e);e.area=d.area,e.parent=e,e.position.x=d.centre.x,e.position.y=d.centre.y,e.positionPrev.x=d.centre.x,e.positionPrev.y=d.centre.y,t.setMass(e,d.mass),t.setInertia(e,d.inertia),t.setPosition(e,d.centre)}},t.setPosition=function(e,t){var n=M.sub(t,e.position);e.positionPrev.x+=n.x,e.positionPrev.y+=n.y;for(var o=0;o<e.parts.length;o++){var i=e.parts[o];i.position.x+=n.x,i.position.y+=n.y,P.translate(i.vertices,n),A.update(i.bounds,i.vertices,e.velocity)}},t.setAngle=function(e,t){var n=t-e.angle;e.anglePrev+=n;for(var o=0;o<e.parts.length;o++){var i=e.parts[o];i.angle+=n,P.rotate(i.vertices,n,e.position),w.rotate(i.axes,n),A.update(i.bounds,i.vertices,e.velocity),o>0&&M.rotateAbout(i.position,n,e.position,i.position)}},t.setVelocity=function(e,t){e.positionPrev.x=e.position.x-t.x,e.positionPrev.y=e.position.y-t.y,e.velocity.x=t.x,e.velocity.y=t.y,e.speed=M.magnitude(e.velocity)},t.setAngularVelocity=function(e,t){e.anglePrev=e.angle-t,e.angularVelocity=t,e.angularSpeed=Math.abs(e.angularVelocity)},t.translate=function(e,n){t.setPosition(e,M.add(e.position,n))},t.rotate=function(e,n){t.setAngle(e,e.angle+n)},t.scale=function(e,n,o){for(var i=0;i<e.parts.length;i++){var s=e.parts[i];P.scale(s.vertices,n,o,e.position),s.axes=w.fromVertices(s.vertices),e.isStatic||(s.area=P.area(s.vertices),t.setMass(s,e.density*s.area),P.translate(s.vertices,{x:-s.position.x,y:-s.position.y}),t.setInertia(s,P.inertia(s.vertices,s.mass)),P.translate(s.vertices,{x:s.position.x,y:s.position.y})),A.update(s.bounds,s.vertices,e.velocity)}if(!e.isStatic){var a=r(e);e.area=a.area,t.setMass(e,a.mass),t.setInertia(e,a.inertia)}},t.update=function(e,t,n,o){var i=Math.pow(t*n*e.timeScale,2),r=1-e.frictionAir*n*e.timeScale,s=e.position.x-e.positionPrev.x,a=e.position.y-e.positionPrev.y;e.velocity.x=s*r*o+e.force.x/e.mass*i,e.velocity.y=a*r*o+e.force.y/e.mass*i,e.positionPrev.x=e.position.x,e.positionPrev.y=e.position.y,e.position.x+=e.velocity.x,e.position.y+=e.velocity.y,e.angularVelocity=(e.angle-e.anglePrev)*r*o+e.torque/e.inertia*i,e.anglePrev=e.angle,e.angle+=e.angularVelocity,e.speed=M.magnitude(e.velocity),e.angularSpeed=Math.abs(e.angularVelocity);for(var l=0;l<e.parts.length;l++){var c=e.parts[l];P.translate(c.vertices,e.velocity),l>0&&(c.position.x+=e.velocity.x,c.position.y+=e.velocity.y),0!==e.angularVelocity&&(P.rotate(c.vertices,e.angularVelocity,e.position),w.rotate(c.axes,e.angularVelocity),l>0&&M.rotateAbout(c.position,e.angularVelocity,e.position,c.position)),A.update(c.bounds,c.vertices,e.velocity)}},t.applyForce=function(e,t,n){e.force.x+=n.x,e.force.y+=n.y;var o={x:t.x-e.position.x,y:t.y-e.position.y};e.torque+=(o.x*n.y-o.y*n.x)*e.inverseInertia};var r=function(e){for(var t={mass:0,area:0,inertia:0,centre:{x:0,y:0}},n=1===e.parts.length?0:1;n<e.parts.length;n++){var o=e.parts[n];t.mass+=o.mass,t.area+=o.area,t.inertia+=o.inertia,t.centre=M.add(t.centre,M.mult(o.position,1/0!==o.mass?o.mass:1))}return t.centre=M.div(t.centre,1/0!==t.mass?t.mass:e.parts.length),t}}();var n={};!function(){n.create=function(e){return f.extend({id:f.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite"},e)},n.setModified=function(e,t,o,i){if(e.isModified=t,o&&e.parent&&n.setModified(e.parent,t,o,i),i)for(var r=0;r<e.composites.length;r++){var s=e.composites[r];n.setModified(s,t,o,i)}},n.add=function(e,t){var o=[].concat(t);m.trigger(e,"beforeAdd",{object:t});for(var i=0;i<o.length;i++){var r=o[i];switch(r.type){case"body":if(r.parent!==r){f.log("Composite.add: skipped adding a compound body part (you must add its parent instead)","warn");break}n.addBody(e,r);break;case"constraint":n.addConstraint(e,r);break;case"composite":n.addComposite(e,r);break;case"mouseConstraint":n.addConstraint(e,r.constraint)}}return m.trigger(e,"afterAdd",{object:t}),e},n.remove=function(e,t,o){var i=[].concat(t);m.trigger(e,"beforeRemove",{object:t});for(var r=0;r<i.length;r++){var s=i[r];switch(s.type){case"body":n.removeBody(e,s,o);break;case"constraint":n.removeConstraint(e,s,o);break;case"composite":n.removeComposite(e,s,o);break;case"mouseConstraint":n.removeConstraint(e,s.constraint)}}return m.trigger(e,"afterRemove",{object:t}),e},n.addComposite=function(e,t){return e.composites.push(t),t.parent=e,n.setModified(e,!0,!0,!1),e},n.removeComposite=function(e,t,o){var i=f.indexOf(e.composites,t);if(-1!==i&&(n.removeCompositeAt(e,i),n.setModified(e,!0,!0,!1)),o)for(var r=0;r<e.composites.length;r++)n.removeComposite(e.composites[r],t,!0);return e},n.removeCompositeAt=function(e,t){return e.composites.splice(t,1),n.setModified(e,!0,!0,!1),e},n.addBody=function(e,t){return e.bodies.push(t),n.setModified(e,!0,!0,!1),e},n.removeBody=function(e,t,o){var i=f.indexOf(e.bodies,t);if(-1!==i&&(n.removeBodyAt(e,i),n.setModified(e,!0,!0,!1)),o)for(var r=0;r<e.composites.length;r++)n.removeBody(e.composites[r],t,!0);return e},n.removeBodyAt=function(e,t){return e.bodies.splice(t,1),n.setModified(e,!0,!0,!1),e},n.addConstraint=function(e,t){return e.constraints.push(t),n.setModified(e,!0,!0,!1),e},n.removeConstraint=function(e,t,o){var i=f.indexOf(e.constraints,t);if(-1!==i&&n.removeConstraintAt(e,i),o)for(var r=0;r<e.composites.length;r++)n.removeConstraint(e.composites[r],t,!0);return e},n.removeConstraintAt=function(e,t){return e.constraints.splice(t,1),n.setModified(e,!0,!0,!1),e},n.clear=function(e,t,o){if(o)for(var i=0;i<e.composites.length;i++)n.clear(e.composites[i],t,!0);return t?e.bodies=e.bodies.filter(function(e){return e.isStatic}):e.bodies.length=0,e.constraints.length=0,e.composites.length=0,n.setModified(e,!0,!0,!1),e},n.allBodies=function(e){for(var t=[].concat(e.bodies),o=0;o<e.composites.length;o++)t=t.concat(n.allBodies(e.composites[o]));return t},n.allConstraints=function(e){for(var t=[].concat(e.constraints),o=0;o<e.composites.length;o++)t=t.concat(n.allConstraints(e.composites[o]));return t},n.allComposites=function(e){for(var t=[].concat(e.composites),o=0;o<e.composites.length;o++)t=t.concat(n.allComposites(e.composites[o]));return t},n.get=function(e,t,o){var i,r;switch(o){case"body":i=n.allBodies(e);break;case"constraint":i=n.allConstraints(e);break;case"composite":i=n.allComposites(e).concat(e)}return i?(r=i.filter(function(e){return e.id.toString()===t.toString()}),0===r.length?null:r[0]):null},n.move=function(e,t,o){return n.remove(e,t),n.add(o,t),e},n.rebase=function(e){for(var t=n.allBodies(e).concat(n.allConstraints(e)).concat(n.allComposites(e)),o=0;o<t.length;o++)t[o].id=f.nextId();return n.setModified(e,!0,!0,!1),e},n.translate=function(e,o,i){for(var r=i?n.allBodies(e):e.bodies,s=0;s<r.length;s++)t.translate(r[s],o);return n.setModified(e,!0,!0,!1),e},n.rotate=function(e,o,i,r){for(var s=Math.cos(o),a=Math.sin(o),l=r?n.allBodies(e):e.bodies,c=0;c<l.length;c++){var d=l[c],u=d.position.x-i.x,p=d.position.y-i.y;t.setPosition(d,{x:i.x+(u*s-p*a),y:i.y+(u*a+p*s)}),t.rotate(d,o)}return n.setModified(e,!0,!0,!1),e},n.scale=function(e,o,i,r,s){for(var a=s?n.allBodies(e):e.bodies,l=0;l<a.length;l++){var c=a[l],d=c.position.x-r.x,u=c.position.y-r.y;t.setPosition(c,{x:r.x+d*o,y:r.y+u*i}),t.scale(c,o,i)}return n.setModified(e,!0,!0,!1),e}}();var o={};!function(){o.create=function(e){var t=n.create(),o={label:"World",gravity:{x:0,y:1},bounds:{min:{x:-1/0,y:-1/0},max:{x:1/0,y:1/0}}};return f.extend(t,o,e)}}();var i={};!function(){i.create=function(e){return{id:i.id(e),vertex:e,normalImpulse:0,tangentImpulse:0}},i.id=function(e){return e.body.id+"_"+e.index}}();var r={};!function(){r.collisions=function(e,t){for(var n=[],o=t.pairs.table,i=0;i<e.length;i++){var s=e[i][0],l=e[i][1];if((!s.isStatic&&!s.isSleeping||!l.isStatic&&!l.isSleeping)&&r.canCollide(s.collisionFilter,l.collisionFilter)&&A.overlaps(s.bounds,l.bounds))for(var c=s.parts.length>1?1:0;c<s.parts.length;c++)for(var d=s.parts[c],p=l.parts.length>1?1:0;p<l.parts.length;p++){var v=l.parts[p];if(d===s&&v===l||A.overlaps(d.bounds,v.bounds)){var f,y=a.id(d,v),m=o[y];f=m&&m.isActive?m.collision:null;var g=u.collides(d,v,f);g.collided&&n.push(g)}}}return n},r.bruteForce=function(e,t){for(var n=[],o=t.pairs.table,i=0;i<e.length;i++)for(var s=i+1;s<e.length;s++){var l=e[i],c=e[s];if((!l.isStatic&&!l.isSleeping||!c.isStatic&&!c.isSleeping)&&r.canCollide(l.collisionFilter,c.collisionFilter)&&A.overlaps(l.bounds,c.bounds)){var d,p=a.id(l,c),v=o[p];d=v&&v.isActive?v.collision:null;var f=u.collides(l,c,d);f.collided&&n.push(f)}}return n},r.canCollide=function(e,t){return e.group===t.group&&0!==e.group?e.group>0:0!==(e.mask&t.category)&&0!==(t.mask&e.category)}}();var s={};!function(){s.create=function(e){var t={controller:s,detector:r.collisions,buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return f.extend(t,e)},s.update=function(n,r,s,a){var u,p,v,f,y,m=s.world,g=n.buckets,x=!1;for(u=0;u<r.length;u++){var h=r[u];if((!h.isSleeping||a)&&!(h.bounds.max.x<0||h.bounds.min.x>m.bounds.width||h.bounds.max.y<0||h.bounds.min.y>m.bounds.height)){var b=t(n,h);if(!h.region||b.id!==h.region.id||a){(!h.region||a)&&(h.region=b);var S=e(b,h.region);for(p=S.startCol;p<=S.endCol;p++)for(v=S.startRow;v<=S.endRow;v++){y=o(p,v),f=g[y];var w=p>=b.startCol&&p<=b.endCol&&v>=b.startRow&&v<=b.endRow,A=p>=h.region.startCol&&p<=h.region.endCol&&v>=h.region.startRow&&v<=h.region.endRow;!w&&A&&A&&f&&c(n,f,h),(h.region===b||w&&!A||a)&&(f||(f=i(g,y)),l(n,f,h))}h.region=b,x=!0}}}x&&(n.pairsList=d(n))},s.clear=function(e){e.buckets={},e.pairs={},e.pairsList=[]};var e=function(e,t){var o=Math.min(e.startCol,t.startCol),i=Math.max(e.endCol,t.endCol),r=Math.min(e.startRow,t.startRow),s=Math.max(e.endRow,t.endRow);return n(o,i,r,s)},t=function(e,t){var o=t.bounds,i=Math.floor(o.min.x/e.bucketWidth),r=Math.floor(o.max.x/e.bucketWidth),s=Math.floor(o.min.y/e.bucketHeight),a=Math.floor(o.max.y/e.bucketHeight);return n(i,r,s,a)},n=function(e,t,n,o){return{id:e+","+t+","+n+","+o,startCol:e,endCol:t,startRow:n,endRow:o}},o=function(e,t){return e+","+t},i=function(e,t){var n=e[t]=[];return n},l=function(e,t,n){for(var o=0;o<t.length;o++){var i=t[o];if(!(n.id===i.id||n.isStatic&&i.isStatic)){var r=a.id(n,i),s=e.pairs[r];s?s[2]+=1:e.pairs[r]=[n,i,1]}}t.push(n)},c=function(e,t,n){t.splice(f.indexOf(t,n),1);for(var o=0;o<t.length;o++){var i=t[o],r=a.id(n,i),s=e.pairs[r];s&&(s[2]-=1)}},d=function(e){var t,n,o=[];t=f.keys(e.pairs);for(var i=0;i<t.length;i++)n=e.pairs[t[i]],n[2]>0?o.push(n):delete e.pairs[t[i]];return o}}();var a={};!function(){a.create=function(e,t){var n=e.bodyA,o=e.bodyB,i=e.parentA,r=e.parentB,s={id:a.id(n,o),bodyA:n,bodyB:o,contacts:{},activeContacts:[],separation:0,isActive:!0,timeCreated:t,timeUpdated:t,inverseMass:i.inverseMass+r.inverseMass,friction:Math.min(i.friction,r.friction),frictionStatic:Math.max(i.frictionStatic,r.frictionStatic),restitution:Math.max(i.restitution,r.restitution),slop:Math.max(i.slop,r.slop)};return a.update(s,e,t),s},a.update=function(e,t,n){var o=e.contacts,r=t.supports,s=e.activeContacts,l=t.parentA,c=t.parentB;if(e.collision=t,e.inverseMass=l.inverseMass+c.inverseMass,e.friction=Math.min(l.friction,c.friction),e.frictionStatic=Math.max(l.frictionStatic,c.frictionStatic),e.restitution=Math.max(l.restitution,c.restitution),e.slop=Math.max(l.slop,c.slop),s.length=0,t.collided){for(var d=0;d<r.length;d++){var u=r[d],p=i.id(u),v=o[p];s.push(v?v:o[p]=i.create(u))}e.separation=t.depth,a.setActive(e,!0,n)}else e.isActive===!0&&a.setActive(e,!1,n)},a.setActive=function(e,t,n){t?(e.isActive=!0,e.timeUpdated=n):(e.isActive=!1,e.activeContacts.length=0)},a.id=function(e,t){return e.id<t.id?e.id+"_"+t.id:t.id+"_"+e.id}}();var l={};!function(){var e=1e3;l.create=function(e){return f.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},e)},l.update=function(e,t,n){var o,i,r,s,l=e.list,c=e.table,d=e.collisionStart,u=e.collisionEnd,p=e.collisionActive,v=[];for(d.length=0,u.length=0,p.length=0,s=0;s<t.length;s++)o=t[s],o.collided&&(i=a.id(o.bodyA,o.bodyB),v.push(i),r=c[i],r?(r.isActive?p.push(r):d.push(r),a.update(r,o,n)):(r=a.create(o,n),c[i]=r,d.push(r),l.push(r)));for(s=0;s<l.length;s++)r=l[s],r.isActive&&-1===f.indexOf(v,r.id)&&(a.setActive(r,!1,n),u.push(r))},l.removeOld=function(t,n){var o,i,r,s,a=t.list,l=t.table,c=[];for(s=0;s<a.length;s++)o=a[s],i=o.collision,i.bodyA.isSleeping||i.bodyB.isSleeping?o.timeUpdated=n:n-o.timeUpdated>e&&c.push(s);for(s=0;s<c.length;s++)r=c[s]-s,o=a[r],delete l[o.id],a.splice(r,1)},l.clear=function(e){return e.table={},e.list.length=0,e.collisionStart.length=0,e.collisionActive.length=0,e.collisionEnd.length=0,e}}();var c={};!function(){c.ray=function(e,t,n,o){o=o||1e-100;for(var i=M.angle(t,n),r=M.magnitude(M.sub(t,n)),s=.5*(n.x+t.x),a=.5*(n.y+t.y),l=b.rectangle(s,a,r,o,{angle:i}),c=[],d=0;d<e.length;d++){var p=e[d];if(A.overlaps(p.bounds,l.bounds))for(var v=1===p.parts.length?0:1;v<p.parts.length;v++){var f=p.parts[v];if(A.overlaps(f.bounds,l.bounds)){var y=u.collides(f,l);if(y.collided){y.body=y.bodyA=y.bodyB=p,c.push(y);break}}}}return c},c.region=function(e,t,n){for(var o=[],i=0;i<e.length;i++){var r=e[i],s=A.overlaps(r.bounds,t);(s&&!n||!s&&n)&&o.push(r)}return o},c.point=function(e,t){for(var n=[],o=0;o<e.length;o++){var i=e[o];if(A.contains(i.bounds,t))for(var r=1===i.parts.length?0:1;r<i.parts.length;r++){var s=i.parts[r];if(A.contains(s.bounds,t)&&P.contains(s.vertices,t)){n.push(i);break}}}return n}}();var d={};!function(){d._restingThresh=4,d._positionDampen=.9,d._positionWarming=.8,d._frictionNormalMultiplier=5,d.preSolvePosition=function(e){var t,n,o;for(t=0;t<e.length;t++)n=e[t],n.isActive&&(o=n.activeContacts.length,n.collision.parentA.totalContacts+=o,n.collision.parentB.totalContacts+=o)},d.solvePosition=function(e,t){var n,o,i,r,s,a,l,c,u=M._temp[0],p=M._temp[1],v=M._temp[2],f=M._temp[3];for(n=0;n<e.length;n++)o=e[n],o.isActive&&(i=o.collision,r=i.parentA,s=i.parentB,a=i.normal,l=M.sub(M.add(s.positionImpulse,s.position,u),M.add(r.positionImpulse,M.sub(s.position,i.penetration,p),v),f),o.separation=M.dot(a,l));for(n=0;n<e.length;n++)o=e[n],!o.isActive||o.separation<0||(i=o.collision,r=i.parentA,s=i.parentB,a=i.normal,positionImpulse=(o.separation-o.slop)*t,(r.isStatic||s.isStatic)&&(positionImpulse*=2),r.isStatic||r.isSleeping||(c=d._positionDampen/r.totalContacts,r.positionImpulse.x+=a.x*positionImpulse*c,r.positionImpulse.y+=a.y*positionImpulse*c),s.isStatic||s.isSleeping||(c=d._positionDampen/s.totalContacts,s.positionImpulse.x-=a.x*positionImpulse*c,s.positionImpulse.y-=a.y*positionImpulse*c))},d.postSolvePosition=function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.totalContacts=0,0!==n.positionImpulse.x||0!==n.positionImpulse.y){for(var o=0;o<n.parts.length;o++){var i=n.parts[o];P.translate(i.vertices,n.positionImpulse),A.update(i.bounds,i.vertices,n.velocity),i.position.x+=n.positionImpulse.x,i.position.y+=n.positionImpulse.y}n.positionPrev.x+=n.positionImpulse.x,n.positionPrev.y+=n.positionImpulse.y,M.dot(n.positionImpulse,n.velocity)<0?(n.positionImpulse.x=0,n.positionImpulse.y=0):(n.positionImpulse.x*=d._positionWarming,n.positionImpulse.y*=d._positionWarming)}}},d.preSolveVelocity=function(e){var t,n,o,i,r,s,a,l,c,d,u,p,v,f,y=M._temp[0],m=M._temp[1];for(t=0;t<e.length;t++)if(o=e[t],o.isActive)for(i=o.activeContacts,r=o.collision,s=r.parentA,a=r.parentB,l=r.normal,c=r.tangent,n=0;n<i.length;n++)d=i[n],u=d.vertex,p=d.normalImpulse,v=d.tangentImpulse,(0!==p||0!==v)&&(y.x=l.x*p+c.x*v,y.y=l.y*p+c.y*v,s.isStatic||s.isSleeping||(f=M.sub(u,s.position,m),s.positionPrev.x+=y.x*s.inverseMass,s.positionPrev.y+=y.y*s.inverseMass,s.anglePrev+=M.cross(f,y)*s.inverseInertia),a.isStatic||a.isSleeping||(f=M.sub(u,a.position,m),a.positionPrev.x-=y.x*a.inverseMass,a.positionPrev.y-=y.y*a.inverseMass,a.anglePrev-=M.cross(f,y)*a.inverseInertia))},d.solveVelocity=function(e,t){for(var n=t*t,o=M._temp[0],i=M._temp[1],r=M._temp[2],s=M._temp[3],a=M._temp[4],l=M._temp[5],c=0;c<e.length;c++){var u=e[c];if(u.isActive){var p=u.collision,v=p.parentA,y=p.parentB,m=p.normal,g=p.tangent,x=u.activeContacts,h=1/x.length;v.velocity.x=v.position.x-v.positionPrev.x,v.velocity.y=v.position.y-v.positionPrev.y,y.velocity.x=y.position.x-y.positionPrev.x,y.velocity.y=y.position.y-y.positionPrev.y,v.angularVelocity=v.angle-v.anglePrev,y.angularVelocity=y.angle-y.anglePrev;for(var b=0;b<x.length;b++){var S=x[b],w=S.vertex,A=M.sub(w,v.position,i),C=M.sub(w,y.position,r),k=M.add(v.velocity,M.mult(M.perp(A),v.angularVelocity),s),P=M.add(y.velocity,M.mult(M.perp(C),y.angularVelocity),a),B=M.sub(k,P,l),I=M.dot(m,B),T=M.dot(g,B),V=Math.abs(T),R=f.sign(T),L=(1+u.restitution)*I,_=f.clamp(u.separation+I,0,1)*d._frictionNormalMultiplier,E=T,F=1/0;V>u.friction*u.frictionStatic*_*n&&(E=u.friction*R*n,F=V);var O=M.cross(A,m),W=M.cross(C,m),N=v.inverseMass+y.inverseMass+v.inverseInertia*O*O+y.inverseInertia*W*W;if(L*=h/N,E*=h/(1+N),0>I&&I*I>d._restingThresh*n)S.normalImpulse=0,S.tangentImpulse=0;else{var q=S.normalImpulse;S.normalImpulse=Math.min(S.normalImpulse+L,0),L=S.normalImpulse-q;var D=S.tangentImpulse;S.tangentImpulse=f.clamp(S.tangentImpulse+E,-F,F),E=S.tangentImpulse-D}o.x=m.x*L+g.x*E,o.y=m.y*L+g.y*E,v.isStatic||v.isSleeping||(v.positionPrev.x+=o.x*v.inverseMass,v.positionPrev.y+=o.y*v.inverseMass,v.anglePrev+=M.cross(A,o)*v.inverseInertia),y.isStatic||y.isSleeping||(y.positionPrev.x-=o.x*y.inverseMass,y.positionPrev.y-=o.y*y.inverseMass,y.anglePrev-=M.cross(C,o)*y.inverseInertia)}}}}}();var u={};!function(){u.collides=function(t,o,i){var r,s,a,l,c=i,d=!1;if(c){var u=t.parent,p=o.parent,v=u.speed*u.speed+u.angularSpeed*u.angularSpeed+p.speed*p.speed+p.angularSpeed*p.angularSpeed;d=c&&c.collided&&.2>v,l=c}else l={collided:!1,bodyA:t,bodyB:o};if(c&&d){var f=l.axisBody,y=f===t?o:t,m=[f.axes[c.axisNumber]];if(a=e(f.vertices,y.vertices,m),l.reused=!0,a.overlap<=0)return l.collided=!1,l}else{if(r=e(t.vertices,o.vertices,t.axes),r.overlap<=0)return l.collided=!1,l;if(s=e(o.vertices,t.vertices,o.axes),s.overlap<=0)return l.collided=!1,l;r.overlap<s.overlap?(a=r,l.axisBody=t):(a=s,l.axisBody=o),l.axisNumber=a.axisNumber}l.bodyA=t.id<o.id?t:o,l.bodyB=t.id<o.id?o:t,l.collided=!0,l.normal=a.axis,l.depth=a.overlap,l.parentA=l.bodyA.parent,l.parentB=l.bodyB.parent,t=l.bodyA,o=l.bodyB,M.dot(l.normal,M.sub(o.position,t.position))>0&&(l.normal=M.neg(l.normal)),l.tangent=M.perp(l.normal),l.penetration={x:l.normal.x*l.depth,y:l.normal.y*l.depth};var g=n(t,o,l.normal),x=l.supports||[];if(x.length=0,P.contains(t.vertices,g[0])&&x.push(g[0]),P.contains(t.vertices,g[1])&&x.push(g[1]),x.length<2){var h=n(o,t,M.neg(l.normal));P.contains(o.vertices,h[0])&&x.push(h[0]),x.length<2&&P.contains(o.vertices,h[1])&&x.push(h[1])}return x.length<1&&(x=[g[0]]),l.supports=x,l};var e=function(e,n,o){for(var i,r,s=M._temp[0],a=M._temp[1],l={overlap:Number.MAX_VALUE},c=0;c<o.length;c++){if(r=o[c],t(s,e,r),t(a,n,r),i=Math.min(s.max-a.min,a.max-s.min),0>=i)return l.overlap=i,l;i<l.overlap&&(l.overlap=i,l.axis=r,l.axisNumber=c)}return l},t=function(e,t,n){for(var o=M.dot(t[0],n),i=o,r=1;r<t.length;r+=1){var s=M.dot(t[r],n);s>i?i=s:o>s&&(o=s)}e.min=o,e.max=i},n=function(e,t,n){for(var o,i,r,s,a=Number.MAX_VALUE,l=M._temp[0],c=t.vertices,d=e.position,u=0;u<c.length;u++)i=c[u],l.x=i.x-d.x,l.y=i.y-d.y,o=-M.dot(n,l),a>o&&(a=o,r=i);var p=r.index-1>=0?r.index-1:c.length-1;i=c[p],l.x=i.x-d.x,l.y=i.y-d.y,a=-M.dot(n,l),s=i;var v=(r.index+1)%c.length;return i=c[v],l.x=i.x-d.x,l.y=i.y-d.y,o=-M.dot(n,l),a>o&&(s=i),[r,s]}}();var p={};!function(){var e=1e-6,t=.001;p.create=function(t){var n=t;n.bodyA&&!n.pointA&&(n.pointA={x:0,y:0}),n.bodyB&&!n.pointB&&(n.pointB={x:0,y:0});var o=n.bodyA?M.add(n.bodyA.position,n.pointA):n.pointA,i=n.bodyB?M.add(n.bodyB.position,n.pointB):n.pointB,r=M.magnitude(M.sub(o,i));n.length=n.length||r||e;var s={visible:!0,lineWidth:2,strokeStyle:"#666"};return n.render=f.extend(s,n.render),n.id=n.id||f.nextId(),n.label=n.label||"Constraint",n.type="constraint",n.stiffness=n.stiffness||1,n.angularStiffness=n.angularStiffness||0,n.angleA=n.bodyA?n.bodyA.angle:n.angleA,n.angleB=n.bodyB?n.bodyB.angle:n.angleB,n},p.solveAll=function(e,t){for(var n=0;n<e.length;n++)p.solve(e[n],t)},p.solve=function(n,o){var i=n.bodyA,r=n.bodyB,s=n.pointA,a=n.pointB;i&&!i.isStatic&&(n.pointA=M.rotate(s,i.angle-n.angleA),n.angleA=i.angle),r&&!r.isStatic&&(n.pointB=M.rotate(a,r.angle-n.angleB),n.angleB=r.angle);var l=s,c=a;if(i&&(l=M.add(i.position,s)),r&&(c=M.add(r.position,a)),l&&c){var d=M.sub(l,c),u=M.magnitude(d);0===u&&(u=e);var p=(u-n.length)/u,v=M.div(d,u),y=M.mult(d,.5*p*n.stiffness*o*o);if(!(Math.abs(1-u/n.length)<t*o)){var m,g,x,b,S,w,A,C;i&&!i.isStatic?(x={x:l.x-i.position.x+y.x,y:l.y-i.position.y+y.y},i.velocity.x=i.position.x-i.positionPrev.x,i.velocity.y=i.position.y-i.positionPrev.y,i.angularVelocity=i.angle-i.anglePrev,m=M.add(i.velocity,M.mult(M.perp(x),i.angularVelocity)),S=M.dot(x,v),A=i.inverseMass+i.inverseInertia*S*S):(m={x:0,y:0},A=i?i.inverseMass:0),r&&!r.isStatic?(b={x:c.x-r.position.x-y.x,y:c.y-r.position.y-y.y},r.velocity.x=r.position.x-r.positionPrev.x,r.velocity.y=r.position.y-r.positionPrev.y,r.angularVelocity=r.angle-r.anglePrev,g=M.add(r.velocity,M.mult(M.perp(b),r.angularVelocity)),w=M.dot(b,v),C=r.inverseMass+r.inverseInertia*w*w):(g={x:0,y:0},C=r?r.inverseMass:0);var k=M.sub(g,m),P=M.dot(v,k)/(A+C);P>0&&(P=0);var B,I={x:v.x*P,y:v.y*P};i&&!i.isStatic&&(B=M.cross(x,I)*i.inverseInertia*(1-n.angularStiffness),h.set(i,!1),B=f.clamp(B,-.01,.01),i.constraintImpulse.x-=y.x,i.constraintImpulse.y-=y.y,i.constraintImpulse.angle+=B,i.position.x-=y.x,i.position.y-=y.y,i.angle+=B),r&&!r.isStatic&&(B=M.cross(b,I)*r.inverseInertia*(1-n.angularStiffness),h.set(r,!1),B=f.clamp(B,-.01,.01),r.constraintImpulse.x+=y.x,r.constraintImpulse.y+=y.y,r.constraintImpulse.angle-=B,r.position.x+=y.x,r.position.y+=y.y,r.angle-=B)}}},p.postSolveAll=function(e){for(var t=0;t<e.length;t++){for(var n=e[t],o=n.constraintImpulse,i=0;i<n.parts.length;i++){var r=n.parts[i];P.translate(r.vertices,o),i>0&&(r.position.x+=o.x,r.position.y+=o.y),0!==o.angle&&(P.rotate(r.vertices,o.angle,n.position),w.rotate(r.axes,o.angle),i>0&&M.rotateAbout(r.position,o.angle,n.position,r.position)),A.update(r.bounds,r.vertices)}o.angle=0,o.x=0,o.y=0}}}();var v={};!function(){v.create=function(t,o){var i=(t?t.mouse:null)||(o?o.mouse:null);!i&&t&&t.render&&t.render.canvas?i=g.create(t.render.canvas):(i=g.create(),f.log("MouseConstraint.create: options.mouse was undefined, engine.render.canvas was undefined, may not function as expected","warn"));var r=p.create({label:"Mouse Constraint",pointA:i.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),s={type:"mouseConstraint",mouse:i,body:null,constraint:r,collisionFilter:{category:1,mask:4294967295,group:0}},a=f.extend(s,o);return m.on(t,"tick",function(){var o=n.allBodies(t.world);v.update(a,o),e(a)}),a},v.update=function(e,t){var n=e.mouse,o=e.constraint,i=e.body;if(0===n.button){if(o.bodyB)h.set(o.bodyB,!1),o.pointA=n.position;else for(var s=0;s<t.length;s++)if(i=t[s],A.contains(i.bounds,n.position)&&r.canCollide(i.collisionFilter,e.collisionFilter))for(var a=i.parts.length>1?1:0;a<i.parts.length;a++){var l=i.parts[a];if(P.contains(l.vertices,n.position)){o.pointA=n.position,o.bodyB=e.body=i,o.pointB={x:n.position.x-i.position.x,y:n.position.y-i.position.y},o.angleB=i.angle,h.set(i,!1),m.trigger(e,"startdrag",{mouse:n,body:i});break}}}else o.bodyB=e.body=null,o.pointB=null,i&&m.trigger(e,"enddrag",{mouse:n,body:i})};var e=function(e){var t=e.mouse,n=t.sourceEvents;n.mousemove&&m.trigger(e,"mousemove",{mouse:t}),n.mousedown&&m.trigger(e,"mousedown",{mouse:t}),n.mouseup&&m.trigger(e,"mouseup",{mouse:t}),g.clearSourceEvents(t)}}();var f={};!function(){f._nextId=0,f._seed=0,f.extend=function(e,t){var n,o,i;"boolean"==typeof t?(n=2,i=t):(n=1,i=!0),o=Array.prototype.slice.call(arguments,n);for(var r=0;r<o.length;r++){var s=o[r];if(s)for(var a in s)i&&s[a]&&s[a].constructor===Object?e[a]&&e[a].constructor!==Object?e[a]=s[a]:(e[a]=e[a]||{},f.extend(e[a],i,s[a])):e[a]=s[a]}return e},f.clone=function(e,t){return f.extend({},t,e)},f.keys=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var n in e)t.push(n);return t},f.values=function(e){var t=[];if(Object.keys){for(var n=Object.keys(e),o=0;o<n.length;o++)t.push(e[n[o]]);return t}for(var i in e)t.push(e[i]);return t},f.shadeColor=function(e,t){var n=parseInt(e.slice(1),16),o=Math.round(2.55*t),i=(n>>16)+o,r=(n>>8&255)+o,s=(255&n)+o;return"#"+(16777216+65536*(255>i?1>i?0:i:255)+256*(255>r?1>r?0:r:255)+(255>s?1>s?0:s:255)).toString(16).slice(1)},f.shuffle=function(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(f.random()*(t+1)),o=e[t];e[t]=e[n],e[n]=o}return e},f.choose=function(e){return e[Math.floor(f.random()*e.length)]},f.isElement=function(e){try{return e instanceof HTMLElement}catch(t){return"object"==typeof e&&1===e.nodeType&&"object"==typeof e.style&&"object"==typeof e.ownerDocument}},f.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},f.clamp=function(e,t,n){return t>e?t:e>n?n:e},f.sign=function(e){return 0>e?-1:1},f.now=function(){var e=window.performance||{};return e.now=function(){return e.now||e.webkitNow||e.msNow||e.oNow||e.mozNow||function(){return+new Date}}(),e.now()},f.random=function(t,n){return t="undefined"!=typeof t?t:0,n="undefined"!=typeof n?n:1,t+e()*(n-t)},f.colorToNumber=function(e){return e=e.replace("#",""),3==e.length&&(e=e.charAt(0)+e.charAt(0)+e.charAt(1)+e.charAt(1)+e.charAt(2)+e.charAt(2)),parseInt(e,16)},f.log=function(e,t){if(console&&console.log&&console.warn)switch(t){case"warn":console.warn("Matter.js:",e);break;case"error":console.log("Matter.js:",e)}},f.nextId=function(){return f._nextId++},f.indexOf=function(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1};var e=function(){return f._seed=(9301*f._seed+49297)%233280,f._seed/233280}}();var y={};!function(){var e=60,i=1e3/e;y.create=function(t,n){n=f.isElement(t)?n:t,t=f.isElement(t)?t:null;var r={enabled:!0,positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],timing:{fps:e,timestamp:0,delta:i,correction:1,deltaMin:1e3/e,deltaMax:1e3/(.5*e),timeScale:1,isFixed:!1,frameRequestId:0},render:{element:t,controller:B},broadphase:{controller:s}},a=f.extend(r,n);return a.render=a.render.controller.create(a.render),a.world=o.create(a.world),a.pairs=l.create(),a.broadphase=a.broadphase.controller.create(a.broadphase),a.metrics=a.metrics||{extended:!1},a},y.update=function(e,t,o){o="undefined"!=typeof o?o:1;var i,s=e.world,u=e.timing,v=e.broadphase,f=[];u.timestamp+=t*u.timeScale,u.correction=o;var y={timestamp:e.timing.timestamp};m.trigger(e,"beforeUpdate",y);var g=n.allBodies(s),x=n.allConstraints(s);for(e.enableSleeping&&h.update(g,u.timeScale),a(g,s.gravity),c(g,t,u.timeScale,o,s.bounds),i=0;i<e.constraintIterations;i++)p.solveAll(x,u.timeScale);p.postSolveAll(g),v.controller?(s.isModified&&v.controller.clear(v),v.controller.update(v,g,e,s.isModified),f=v.pairsList):f=g;var b=v.detector(f,e),S=e.pairs,w=u.timestamp;for(l.update(S,b,w),l.removeOld(S,w),e.enableSleeping&&h.afterCollisions(S.list,u.timeScale),S.collisionStart.length>0&&m.trigger(e,"collisionStart",{pairs:S.collisionStart}),d.preSolvePosition(S.list),i=0;i<e.positionIterations;i++)d.solvePosition(S.list,u.timeScale);for(d.postSolvePosition(g),d.preSolveVelocity(S.list),i=0;i<e.velocityIterations;i++)d.solveVelocity(S.list,u.timeScale);return S.collisionActive.length>0&&m.trigger(e,"collisionActive",{pairs:S.collisionActive}),S.collisionEnd.length>0&&m.trigger(e,"collisionEnd",{pairs:S.collisionEnd}),r(g),s.isModified&&n.setModified(s,!1,!1,!0),m.trigger(e,"afterUpdate",y),e},y.render=function(e){var t={timestamp:e.timing.timestamp};m.trigger(e,"beforeRender",t),e.render.controller.world(e),m.trigger(e,"afterRender",t)},y.merge=function(e,t){if(f.extend(e,t),t.world){e.world=t.world,y.clear(e);for(var o=n.allBodies(e.world),i=0;i<o.length;i++){var r=o[i];h.set(r,!1),r.id=f.nextId()}}},y.clear=function(e){var t=e.world;l.clear(e.pairs);var o=e.broadphase;if(o.controller){var i=n.allBodies(t);o.controller.clear(o),o.controller.update(o,i,e,!0)}};var r=function(e){for(var t=0;t<e.length;t++){var n=e[t];n.force.x=0,n.force.y=0,n.torque=0}},a=function(e,t){for(var n=0;n<e.length;n++){var o=e[n];o.isStatic||o.isSleeping||(o.force.y+=o.mass*t.y*.001,o.force.x+=o.mass*t.x*.001)}},c=function(e,n,o,i){for(var r=0;r<e.length;r++){var s=e[r];s.isStatic||s.isSleeping||t.update(s,n,o,i)}}}();var m={};!function(){m.on=function(e,t,n){for(var o,i=t.split(" "),r=0;r<i.length;r++)o=i[r],e.events=e.events||{},e.events[o]=e.events[o]||[],e.events[o].push(n);return n},m.off=function(e,t,n){if(!t)return void(e.events={});"function"==typeof t&&(n=t,t=f.keys(e.events).join(" "));for(var o=t.split(" "),i=0;i<o.length;i++){var r=e.events[o[i]],s=[];if(n)for(var a=0;a<r.length;a++)r[a]!==n&&s.push(r[a]);e.events[o[i]]=s}},m.trigger=function(e,t,n){var o,i,r,s;if(e.events){n||(n={}),o=t.split(" ");for(var a=0;a<o.length;a++)if(i=o[a],r=e.events[i]){s=f.clone(n,!1),s.name=i,s.source=e;for(var l=0;l<r.length;l++)r[l].apply(e,[s])}}}}();var g={};!function(){g.create=function(t){var n={};return t||f.log("Mouse.create: element was undefined, defaulting to document.body","warn"),n.element=t||document.body,n.absolute={x:0,y:0},n.position={x:0,y:0},n.mousedownPosition={x:0,y:0},n.mouseupPosition={x:0,y:0},n.offset={x:0,y:0},n.scale={x:1,y:1},n.wheelDelta=0,n.button=-1,n.pixelRatio=n.element.getAttribute("data-pixel-ratio")||1,n.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},n.mousemove=function(t){var o=e(t,n.element,n.pixelRatio),i=t.changedTouches;
i&&(n.button=0,t.preventDefault()),n.absolute.x=o.x,n.absolute.y=o.y,n.position.x=n.absolute.x*n.scale.x+n.offset.x,n.position.y=n.absolute.y*n.scale.y+n.offset.y,n.sourceEvents.mousemove=t},n.mousedown=function(t){var o=e(t,n.element,n.pixelRatio),i=t.changedTouches;i?(n.button=0,t.preventDefault()):n.button=t.button,n.absolute.x=o.x,n.absolute.y=o.y,n.position.x=n.absolute.x*n.scale.x+n.offset.x,n.position.y=n.absolute.y*n.scale.y+n.offset.y,n.mousedownPosition.x=n.position.x,n.mousedownPosition.y=n.position.y,n.sourceEvents.mousedown=t},n.mouseup=function(t){var o=e(t,n.element,n.pixelRatio),i=t.changedTouches;i&&t.preventDefault(),n.button=-1,n.absolute.x=o.x,n.absolute.y=o.y,n.position.x=n.absolute.x*n.scale.x+n.offset.x,n.position.y=n.absolute.y*n.scale.y+n.offset.y,n.mouseupPosition.x=n.position.x,n.mouseupPosition.y=n.position.y,n.sourceEvents.mouseup=t},n.mousewheel=function(e){n.wheelDelta=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail)),e.preventDefault()},g.setElement(n,n.element),n},g.setElement=function(e,t){e.element=t,t.addEventListener("mousemove",e.mousemove),t.addEventListener("mousedown",e.mousedown),t.addEventListener("mouseup",e.mouseup),t.addEventListener("mousewheel",e.mousewheel),t.addEventListener("DOMMouseScroll",e.mousewheel),t.addEventListener("touchmove",e.mousemove),t.addEventListener("touchstart",e.mousedown),t.addEventListener("touchend",e.mouseup)},g.clearSourceEvents=function(e){e.sourceEvents.mousemove=null,e.sourceEvents.mousedown=null,e.sourceEvents.mouseup=null,e.sourceEvents.mousewheel=null,e.wheelDelta=0},g.setOffset=function(e,t){e.offset.x=t.x,e.offset.y=t.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y},g.setScale=function(e,t){e.scale.x=t.x,e.scale.y=t.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y};var e=function(e,t,n){var o,i,r=t.getBoundingClientRect(),s=document.documentElement||document.body.parentNode||document.body,a=void 0!==window.pageXOffset?window.pageXOffset:s.scrollLeft,l=void 0!==window.pageYOffset?window.pageYOffset:s.scrollTop,c=e.changedTouches;return c?(o=c[0].pageX-r.left-a,i=c[0].pageY-r.top-l):(o=e.pageX-r.left-a,i=e.pageY-r.top-l),{x:o/(t.clientWidth/t.width*n),y:i/(t.clientHeight/t.height*n)}}}();var x={};!function(){var e=60,t=e,n=1e3/e,o=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(function(){e(f.now())},n)},i=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame;x.run=function(e){var n,i=0,r=0,s=[],a=1;!function l(c){var d,u=e.timing,p=1;if(u.frameRequestId=o(l),e.enabled){var v={timestamp:c};m.trigger(e,"beforeTick",v),u.isFixed?d=u.delta:(d=c-n||u.delta,n=c,s.push(d),s=s.slice(-t),d=Math.min.apply(null,s),d=d<u.deltaMin?u.deltaMin:d,d=d>u.deltaMax?u.deltaMax:d,p=d/u.delta,u.delta=d),0!==a&&(p*=u.timeScale/a),0===u.timeScale&&(p=0),a=u.timeScale,r+=1,c-i>=1e3&&(u.fps=r*((c-i)/1e3),i=c,r=0),m.trigger(e,"tick",v),e.world.isModified&&e.render.controller.clear&&e.render.controller.clear(e.render),y.update(e,d,p),y.render(e),m.trigger(e,"afterTick",v)}}()},x.stop=function(e){i(e.timing.frameRequestId)}}();var h={};!function(){h._motionWakeThreshold=.18,h._motionSleepThreshold=.08,h._minBias=.9,h.update=function(e,t){for(var n=t*t*t,o=0;o<e.length;o++){var i=e[o],r=i.speed*i.speed+i.angularSpeed*i.angularSpeed;if(0===i.force.x&&0===i.force.y){var s=Math.min(i.motion,r),a=Math.max(i.motion,r);i.motion=h._minBias*s+(1-h._minBias)*a,i.sleepThreshold>0&&i.motion<h._motionSleepThreshold*n?(i.sleepCounter+=1,i.sleepCounter>=i.sleepThreshold&&h.set(i,!0)):i.sleepCounter>0&&(i.sleepCounter-=1)}else h.set(i,!1)}},h.afterCollisions=function(e,t){for(var n=t*t*t,o=0;o<e.length;o++){var i=e[o];if(i.isActive){var r=i.collision,s=r.bodyA.parent,a=r.bodyB.parent;if(!(s.isSleeping&&a.isSleeping||s.isStatic||a.isStatic)&&(s.isSleeping||a.isSleeping)){var l=s.isSleeping&&!s.isStatic?s:a,c=l===s?a:s;!l.isStatic&&c.motion>h._motionWakeThreshold*n&&h.set(l,!1)}}}},h.set=function(e,t){t?(e.isSleeping=!0,e.sleepCounter=e.sleepThreshold,e.positionImpulse.x=0,e.positionImpulse.y=0,e.positionPrev.x=e.position.x,e.positionPrev.y=e.position.y,e.anglePrev=e.angle,e.speed=0,e.angularSpeed=0,e.motion=0):(e.isSleeping=!1,e.sleepCounter=0)}}();var b={};!function(){b.rectangle=function(e,n,o,i,r){r=r||{};var s={label:"Rectangle Body",position:{x:e,y:n},vertices:P.fromPath("L 0 0 L "+o+" 0 L "+o+" "+i+" L 0 "+i)};if(r.chamfer){var a=r.chamfer;s.vertices=P.chamfer(s.vertices,a.radius,a.quality,a.qualityMin,a.qualityMax),delete r.chamfer}return t.create(f.extend({},s,r))},b.trapezoid=function(e,n,o,i,r,s){s=s||{},r*=.5;var a=(1-2*r)*o,l=o*r,c=l+a,d=c+l,u={label:"Trapezoid Body",position:{x:e,y:n},vertices:P.fromPath("L 0 0 L "+l+" "+-i+" L "+c+" "+-i+" L "+d+" 0")};if(s.chamfer){var p=s.chamfer;u.vertices=P.chamfer(u.vertices,p.radius,p.quality,p.qualityMin,p.qualityMax),delete s.chamfer}return t.create(f.extend({},u,s))},b.circle=function(e,t,n,o,i){o=o||{},o.label="Circle Body",i=i||25;var r=Math.ceil(Math.max(10,Math.min(i,n)));return r%2===1&&(r+=1),o.circleRadius=n,b.polygon(e,t,r,n,o)},b.polygon=function(e,n,o,i,r){if(r=r||{},3>o)return b.circle(e,n,i,r);for(var s=2*Math.PI/o,a="",l=.5*s,c=0;o>c;c+=1){var d=l+c*s,u=Math.cos(d)*i,p=Math.sin(d)*i;a+="L "+u.toFixed(3)+" "+p.toFixed(3)+" "}var v={label:"Polygon Body",position:{x:e,y:n},vertices:P.fromPath(a)};if(r.chamfer){var y=r.chamfer;v.vertices=P.chamfer(v.vertices,y.radius,y.quality,y.qualityMin,y.qualityMax),delete r.chamfer}return t.create(f.extend({},v,r))},b.fromVertices=function(e,n,o,i,r,s,a){var l,c,d,u,p,v,y,m,g;for(i=i||{},c=[],r="undefined"!=typeof r?r:!1,s="undefined"!=typeof s?s:.01,a="undefined"!=typeof a?a:10,window.decomp||f.log("Bodies.fromVertices: poly-decomp.js required. Could not decompose vertices. Fallback to convex hull.","warn"),f.isArray(o[0])||(o=[o]),m=0;m<o.length;m+=1)if(u=o[m],d=P.isConvex(u),d||!window.decomp)u=d?P.clockwiseSort(u):P.hull(u),c.push({position:{x:e,y:n},vertices:u});else{var x=new decomp.Polygon;for(p=0;p<u.length;p++)x.vertices.push([u[p].x,u[p].y]);x.makeCCW(),s!==!1&&x.removeCollinearPoints(s);var h=x.quickDecomp();for(p=0;p<h.length;p++){var b=h[p],S=[];for(v=0;v<b.vertices.length;v++)S.push({x:b.vertices[v][0],y:b.vertices[v][1]});a>0&&P.area(S)<a||c.push({position:P.centre(S),vertices:S})}}for(p=0;p<c.length;p++)c[p]=t.create(f.extend(c[p],i));if(r){var w=5;for(p=0;p<c.length;p++){var C=c[p];for(v=p+1;v<c.length;v++){var k=c[v];if(A.overlaps(C.bounds,k.bounds)){var B=C.vertices,I=k.vertices;for(y=0;y<C.vertices.length;y++)for(g=0;g<k.vertices.length;g++){var T=M.magnitudeSquared(M.sub(B[(y+1)%B.length],I[g])),V=M.magnitudeSquared(M.sub(B[y],I[(g+1)%I.length]));w>T&&w>V&&(B[y].isInternal=!0,I[g].isInternal=!0)}}}}}return c.length>1?(l=t.create(f.extend({parts:c.slice(0)},i)),t.setPosition(l,{x:e,y:n}),l):c[0]}}();var S={};!function(){S.stack=function(e,o,i,r,s,a,l){for(var c,d=n.create({label:"Stack"}),u=e,p=o,v=0,f=0;r>f;f++){for(var y=0,m=0;i>m;m++){var g=l(u,p,m,f,c,v);if(g){var x=g.bounds.max.y-g.bounds.min.y,h=g.bounds.max.x-g.bounds.min.x;x>y&&(y=x),t.translate(g,{x:.5*h,y:.5*x}),u=g.bounds.max.x+s,n.addBody(d,g),c=g,v+=1}else u+=s}p+=y+a,u=e}return d},S.chain=function(e,t,o,i,r,s){for(var a=e.bodies,l=1;l<a.length;l++){var c=a[l-1],d=a[l],u=c.bounds.max.y-c.bounds.min.y,v=c.bounds.max.x-c.bounds.min.x,y=d.bounds.max.y-d.bounds.min.y,m=d.bounds.max.x-d.bounds.min.x,g={bodyA:c,pointA:{x:v*t,y:u*o},bodyB:d,pointB:{x:m*i,y:y*r}},x=f.extend(g,s);n.addConstraint(e,p.create(x))}return e.label+=" Chain",e},S.mesh=function(e,t,o,i,r){var s,a,l,c,d,u=e.bodies;for(s=0;o>s;s++){for(a=1;t>a;a++)l=u[a-1+s*t],c=u[a+s*t],n.addConstraint(e,p.create(f.extend({bodyA:l,bodyB:c},r)));if(s>0)for(a=0;t>a;a++)l=u[a+(s-1)*t],c=u[a+s*t],n.addConstraint(e,p.create(f.extend({bodyA:l,bodyB:c},r))),i&&a>0&&(d=u[a-1+(s-1)*t],n.addConstraint(e,p.create(f.extend({bodyA:d,bodyB:c},r)))),i&&t-1>a&&(d=u[a+1+(s-1)*t],n.addConstraint(e,p.create(f.extend({bodyA:d,bodyB:c},r))))}return e.label+=" Mesh",e},S.pyramid=function(e,n,o,i,r,s,a){return S.stack(e,n,o,i,r,s,function(n,s,l,c,d,u){var p=Math.min(i,Math.ceil(o/2)),v=d?d.bounds.max.x-d.bounds.min.x:0;if(!(c>p)){c=p-c;var f=c,y=o-1-c;if(!(f>l||l>y)){1===u&&t.translate(d,{x:(l+(o%2===1?1:-1))*v,y:0});var m=d?l*v:0;return a(e+m+l*r,s,l,c,d,u)}}})},S.newtonsCradle=function(e,t,o,i,r){for(var s=n.create({label:"Newtons Cradle"}),a=0;o>a;a++){var l=1.9,c=b.circle(e+a*i*l,t+r,i,{inertia:99999,restitution:1,friction:0,frictionAir:1e-4,slop:.01}),d=p.create({pointA:{x:e+a*i*l,y:t},bodyB:c});n.addBody(s,c),n.addConstraint(s,d)}return s},S.car=function(e,o,i,r,s){var a=t.nextGroup(!0),l=-20,c=.5*-i+l,d=.5*i-l,u=0,v=n.create({label:"Car"}),f=b.trapezoid(e,o,i,r,.3,{collisionFilter:{group:a},friction:.01,chamfer:{radius:10}}),y=b.circle(e+c,o+u,s,{collisionFilter:{group:a},restitution:.5,friction:.9,frictionStatic:10,slop:.5,density:.01}),m=b.circle(e+d,o+u,s,{collisionFilter:{group:a},restitution:.5,friction:.9,frictionStatic:10,slop:.5,density:.01}),g=p.create({bodyA:f,pointA:{x:c,y:u},bodyB:y,stiffness:.5}),x=p.create({bodyA:f,pointA:{x:d,y:u},bodyB:m,stiffness:.5});return n.addBody(v,f),n.addBody(v,y),n.addBody(v,m),n.addConstraint(v,g),n.addConstraint(v,x),v},S.softBody=function(e,t,n,o,i,r,s,a,l,c){l=f.extend({inertia:1/0},l),c=f.extend({stiffness:.4},c);var d=S.stack(e,t,n,o,i,r,function(e,t){return b.circle(e,t,a,l)});return S.mesh(d,n,o,s,c),d.label="Soft Body",d}}();var w={};!function(){w.fromVertices=function(e){for(var t={},n=0;n<e.length;n++){var o=(n+1)%e.length,i=M.normalise({x:e[o].y-e[n].y,y:e[n].x-e[o].x}),r=0===i.y?1/0:i.x/i.y;r=r.toFixed(3).toString(),t[r]=i}return f.values(t)},w.rotate=function(e,t){if(0!==t)for(var n=Math.cos(t),o=Math.sin(t),i=0;i<e.length;i++){var r,s=e[i];r=s.x*n-s.y*o,s.y=s.x*o+s.y*n,s.x=r}}}();var A={};!function(){A.create=function(e){var t={min:{x:0,y:0},max:{x:0,y:0}};return e&&A.update(t,e),t},A.update=function(e,t,n){e.min.x=Number.MAX_VALUE,e.max.x=Number.MIN_VALUE,e.min.y=Number.MAX_VALUE,e.max.y=Number.MIN_VALUE;for(var o=0;o<t.length;o++){var i=t[o];i.x>e.max.x&&(e.max.x=i.x),i.x<e.min.x&&(e.min.x=i.x),i.y>e.max.y&&(e.max.y=i.y),i.y<e.min.y&&(e.min.y=i.y)}n&&(n.x>0?e.max.x+=n.x:e.min.x+=n.x,n.y>0?e.max.y+=n.y:e.min.y+=n.y)},A.contains=function(e,t){return t.x>=e.min.x&&t.x<=e.max.x&&t.y>=e.min.y&&t.y<=e.max.y},A.overlaps=function(e,t){return e.min.x<=t.max.x&&e.max.x>=t.min.x&&e.max.y>=t.min.y&&e.min.y<=t.max.y},A.translate=function(e,t){e.min.x+=t.x,e.max.x+=t.x,e.min.y+=t.y,e.max.y+=t.y},A.shift=function(e,t){var n=e.max.x-e.min.x,o=e.max.y-e.min.y;e.min.x=t.x,e.max.x=t.x+n,e.min.y=t.y,e.max.y=t.y+o}}();var C={};!function(){C.pathToVertices=function(t,n){var o,i,r,s,a,l,c,d,u,p,v=[],f=0,y=0,m=0;n=n||15;var g=function(e,t,n){var o=n%2===1&&n>1;if(!u||e!=u.x||t!=u.y){u&&o?(lx=u.x,ly=u.y):(lx=0,ly=0);var i={x:lx+e,y:ly+t};(o||!u)&&(u=i),v.push(i),y=lx+e,m=ly+t}},x=function(e){var t=e.pathSegTypeAsLetter.toUpperCase();if("Z"!==t){switch(t){case"M":case"L":case"T":case"C":case"S":case"Q":y=e.x,m=e.y;break;case"H":y=e.x;break;case"V":m=e.y}g(y,m,e.pathSegType)}};for(e(t),r=t.getTotalLength(),l=[],o=0;o<t.pathSegList.numberOfItems;o+=1)l.push(t.pathSegList.getItem(o));for(c=l.concat();r>f;){if(p=t.getPathSegAtLength(f),a=l[p],a!=d){for(;c.length&&c[0]!=a;)x(c.shift());d=a}switch(a.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":s=t.getPointAtLength(f),g(s.x,s.y,0)}f+=n}for(o=0,i=c.length;i>o;++o)x(c[o]);return v};var e=function(e){for(var t,n,o,i,r,s,a=e.pathSegList,l=0,c=0,d=a.numberOfItems,u=0;d>u;++u){var p=a.getItem(u),v=p.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(v))"x"in p&&(l=p.x),"y"in p&&(c=p.y);else switch("x1"in p&&(o=l+p.x1),"x2"in p&&(r=l+p.x2),"y1"in p&&(i=c+p.y1),"y2"in p&&(s=c+p.y2),"x"in p&&(l+=p.x),"y"in p&&(c+=p.y),v){case"m":a.replaceItem(e.createSVGPathSegMovetoAbs(l,c),u);break;case"l":a.replaceItem(e.createSVGPathSegLinetoAbs(l,c),u);break;case"h":a.replaceItem(e.createSVGPathSegLinetoHorizontalAbs(l),u);break;case"v":a.replaceItem(e.createSVGPathSegLinetoVerticalAbs(c),u);break;case"c":a.replaceItem(e.createSVGPathSegCurvetoCubicAbs(l,c,o,i,r,s),u);break;case"s":a.replaceItem(e.createSVGPathSegCurvetoCubicSmoothAbs(l,c,r,s),u);break;case"q":a.replaceItem(e.createSVGPathSegCurvetoQuadraticAbs(l,c,o,i),u);break;case"t":a.replaceItem(e.createSVGPathSegCurvetoQuadraticSmoothAbs(l,c),u);break;case"a":a.replaceItem(e.createSVGPathSegArcAbs(l,c,p.r1,p.r2,p.angle,p.largeArcFlag,p.sweepFlag),u);break;case"z":case"Z":l=t,c=n}("M"==v||"m"==v)&&(t=l,n=c)}}}();var M={};!function(){M.create=function(e,t){return{x:e||0,y:t||0}},M.clone=function(e){return{x:e.x,y:e.y}},M.magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},M.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y},M.rotate=function(e,t){var n=Math.cos(t),o=Math.sin(t);return{x:e.x*n-e.y*o,y:e.x*o+e.y*n}},M.rotateAbout=function(e,t,n,o){var i=Math.cos(t),r=Math.sin(t);o||(o={});var s=n.x+((e.x-n.x)*i-(e.y-n.y)*r);return o.y=n.y+((e.x-n.x)*r+(e.y-n.y)*i),o.x=s,o},M.normalise=function(e){var t=M.magnitude(e);return 0===t?{x:0,y:0}:{x:e.x/t,y:e.y/t}},M.dot=function(e,t){return e.x*t.x+e.y*t.y},M.cross=function(e,t){return e.x*t.y-e.y*t.x},M.cross3=function(e,t,n){return(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x)},M.add=function(e,t,n){return n||(n={}),n.x=e.x+t.x,n.y=e.y+t.y,n},M.sub=function(e,t,n){return n||(n={}),n.x=e.x-t.x,n.y=e.y-t.y,n},M.mult=function(e,t){return{x:e.x*t,y:e.y*t}},M.div=function(e,t){return{x:e.x/t,y:e.y/t}},M.perp=function(e,t){return t=t===!0?-1:1,{x:t*-e.y,y:t*e.x}},M.neg=function(e){return{x:-e.x,y:-e.y}},M.angle=function(e,t){return Math.atan2(t.y-e.y,t.x-e.x)},M._temp=[M.create(),M.create(),M.create(),M.create(),M.create(),M.create()]}();var P={};!function(){P.create=function(e,t){for(var n=[],o=0;o<e.length;o++){var i=e[o],r={x:i.x,y:i.y,index:o,body:t,isInternal:!1};n.push(r)}return n},P.fromPath=function(e,t){var n=/L?\s*([\-\d\.e]+)[\s,]*([\-\d\.e]+)*/gi,o=[];return e.replace(n,function(e,t,n){o.push({x:parseFloat(t),y:parseFloat(n)})}),P.create(o,t)},P.centre=function(e){for(var t,n,o,i=P.area(e,!0),r={x:0,y:0},s=0;s<e.length;s++)o=(s+1)%e.length,t=M.cross(e[s],e[o]),n=M.mult(M.add(e[s],e[o]),t),r=M.add(r,n);return M.div(r,6*i)},P.mean=function(e){for(var t={x:0,y:0},n=0;n<e.length;n++)t.x+=e[n].x,t.y+=e[n].y;return M.div(t,e.length)},P.area=function(e,t){for(var n=0,o=e.length-1,i=0;i<e.length;i++)n+=(e[o].x-e[i].x)*(e[o].y+e[i].y),o=i;return t?n/2:Math.abs(n)/2},P.inertia=function(e,t){for(var n,o,i=0,r=0,s=e,a=0;a<s.length;a++)o=(a+1)%s.length,n=Math.abs(M.cross(s[o],s[a])),i+=n*(M.dot(s[o],s[o])+M.dot(s[o],s[a])+M.dot(s[a],s[a])),r+=n;return t/6*(i/r)},P.translate=function(e,t,n){var o;if(n)for(o=0;o<e.length;o++)e[o].x+=t.x*n,e[o].y+=t.y*n;else for(o=0;o<e.length;o++)e[o].x+=t.x,e[o].y+=t.y;return e},P.rotate=function(e,t,n){if(0!==t){for(var o=Math.cos(t),i=Math.sin(t),r=0;r<e.length;r++){var s=e[r],a=s.x-n.x,l=s.y-n.y;s.x=n.x+(a*o-l*i),s.y=n.y+(a*i+l*o)}return e}},P.contains=function(e,t){for(var n=0;n<e.length;n++){var o=e[n],i=e[(n+1)%e.length];if((t.x-o.x)*(i.y-o.y)+(t.y-o.y)*(o.x-i.x)>0)return!1}return!0},P.scale=function(e,t,n,o){if(1===t&&1===n)return e;o=o||P.centre(e);for(var i,r,s=0;s<e.length;s++)i=e[s],r=M.sub(i,o),e[s].x=o.x+r.x*t,e[s].y=o.y+r.y*n;return e},P.chamfer=function(e,t,n,o,i){t=t||[8],t.length||(t=[t]),n="undefined"!=typeof n?n:-1,o=o||2,i=i||14;for(var r=[],s=0;s<e.length;s++){var a=e[s-1>=0?s-1:e.length-1],l=e[s],c=e[(s+1)%e.length],d=t[s<t.length?s:t.length-1];if(0!==d){var u=M.normalise({x:l.y-a.y,y:a.x-l.x}),p=M.normalise({x:c.y-l.y,y:l.x-c.x}),v=Math.sqrt(2*Math.pow(d,2)),y=M.mult(f.clone(u),d),m=M.normalise(M.mult(M.add(u,p),.5)),g=M.sub(l,M.mult(m,v)),x=n;-1===n&&(x=1.75*Math.pow(d,.32)),x=f.clamp(x,o,i),x%2===1&&(x+=1);for(var h=Math.acos(M.dot(u,p)),b=h/x,S=0;x>S;S++)r.push(M.add(M.rotate(y,b*S),g))}else r.push(l)}return r},P.clockwiseSort=function(e){var t=P.mean(e);return e.sort(function(e,n){return M.angle(t,e)-M.angle(t,n)}),e},P.isConvex=function(e){var t,n,o,i,r=0,s=e.length;if(3>s)return null;for(t=0;s>t;t++)if(n=(t+1)%s,o=(t+2)%s,i=(e[n].x-e[t].x)*(e[o].y-e[n].y),i-=(e[n].y-e[t].y)*(e[o].x-e[n].x),0>i?r|=1:i>0&&(r|=2),3===r)return!1;return 0!==r?!0:null},P.hull=function(e){var t,n,o=[],i=[];for(e=e.slice(0),e.sort(function(e,t){var n=e.x-t.x;return 0!==n?n:e.y-t.y}),n=0;n<e.length;n++){for(t=e[n];i.length>=2&&M.cross3(i[i.length-2],i[i.length-1],t)<=0;)i.pop();i.push(t)}for(n=e.length-1;n>=0;n--){for(t=e[n];o.length>=2&&M.cross3(o[o.length-2],o[o.length-1],t)<=0;)o.pop();o.push(t)}return o.pop(),i.pop(),o.concat(i)}}();var B={};!function(){B.create=function(t){var n={controller:B,element:null,canvas:null,options:{width:800,height:600,pixelRatio:1,background:"#fafafa",wireframeBackground:"#222",hasBounds:!1,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1}},o=f.extend(n,t);return o.canvas=o.canvas||e(o.options.width,o.options.height),o.context=o.canvas.getContext("2d"),o.textures={},o.bounds=o.bounds||{min:{x:0,y:0},max:{x:o.options.width,y:o.options.height}},1!==o.options.pixelRatio&&B.setPixelRatio(o,o.options.pixelRatio),f.isElement(o.element)?o.element.appendChild(o.canvas):f.log("Render.create: options.element was undefined, render.canvas was created but not appended","warn"),o},B.setPixelRatio=function(e,n){var o=e.options,i=e.canvas;"auto"===n&&(n=t(i)),o.pixelRatio=n,i.setAttribute("data-pixel-ratio",n),i.width=o.width*n,i.height=o.height*n,i.style.width=o.width+"px",i.style.height=o.height+"px",e.context.scale(n,n)},B.world=function(e){var t,o=e.render,r=e.world,a=o.canvas,l=o.context,c=o.options,d=n.allBodies(r),u=n.allConstraints(r),p=c.wireframes?c.wireframeBackground:c.background,v=[],f=[];if(o.currentBackground!==p&&i(o,p),l.globalCompositeOperation="source-in",l.fillStyle="transparent",l.fillRect(0,0,a.width,a.height),l.globalCompositeOperation="source-over",c.hasBounds){var y=o.bounds.max.x-o.bounds.min.x,m=o.bounds.max.y-o.bounds.min.y,g=y/c.width,x=m/c.height;for(t=0;t<d.length;t++){var h=d[t];A.overlaps(h.bounds,o.bounds)&&v.push(h)}for(t=0;t<u.length;t++){var b=u[t],S=b.bodyA,w=b.bodyB,C=b.pointA,k=b.pointB;S&&(C=M.add(S.position,b.pointA)),w&&(k=M.add(w.position,b.pointB)),C&&k&&(A.contains(o.bounds,C)||A.contains(o.bounds,k))&&f.push(b)}l.scale(1/g,1/x),l.translate(-o.bounds.min.x,-o.bounds.min.y)}else f=u,v=d;!c.wireframes||e.enableSleeping&&c.showSleeping?B.bodies(e,v,l):(c.showConvexHulls&&B.bodyConvexHulls(e,v,l),B.bodyWireframes(e,v,l)),c.showBounds&&B.bodyBounds(e,v,l),(c.showAxes||c.showAngleIndicator)&&B.bodyAxes(e,v,l),c.showPositions&&B.bodyPositions(e,v,l),c.showVelocity&&B.bodyVelocity(e,v,l),c.showIds&&B.bodyIds(e,v,l),c.showSeparations&&B.separations(e,e.pairs.list,l),c.showCollisions&&B.collisions(e,e.pairs.list,l),c.showVertexNumbers&&B.vertexNumbers(e,v,l),B.constraints(f,l),c.showBroadphase&&e.broadphase.controller===s&&B.grid(e,e.broadphase,l),c.showDebug&&B.debug(e,l),c.hasBounds&&l.setTransform(c.pixelRatio,0,0,c.pixelRatio,0,0)},B.debug=function(e,t){var o=t,i=e.world,r=e.render,s=r.options,a=(n.allBodies(i),"    ");if(e.timing.timestamp-(r.debugTimestamp||0)>=500){var l="";l+="fps: "+Math.round(e.timing.fps)+a,r.debugString=l,r.debugTimestamp=e.timing.timestamp}if(r.debugString){o.font="12px Arial",o.fillStyle=s.wireframes?"rgba(255,255,255,0.5)":"rgba(0,0,0,0.5)";for(var c=r.debugString.split("\n"),d=0;d<c.length;d++)o.fillText(c[d],50,50+18*d)}},B.constraints=function(e,t){for(var n=t,o=0;o<e.length;o++){var i=e[o];if(i.render.visible&&i.pointA&&i.pointB){var r=i.bodyA,s=i.bodyB;r?(n.beginPath(),n.moveTo(r.position.x+i.pointA.x,r.position.y+i.pointA.y)):(n.beginPath(),n.moveTo(i.pointA.x,i.pointA.y)),s?n.lineTo(s.position.x+i.pointB.x,s.position.y+i.pointB.y):n.lineTo(i.pointB.x,i.pointB.y),n.lineWidth=i.render.lineWidth,n.strokeStyle=i.render.strokeStyle,n.stroke()}}},B.bodyShadows=function(e,t,n){for(var o=n,i=e.render,r=0;r<t.length;r++){var s=t[r];if(s.render.visible){if(s.circleRadius)o.beginPath(),o.arc(s.position.x,s.position.y,s.circleRadius,0,2*Math.PI),o.closePath();else{o.beginPath(),o.moveTo(s.vertices[0].x,s.vertices[0].y);for(var a=1;a<s.vertices.length;a++)o.lineTo(s.vertices[a].x,s.vertices[a].y);o.closePath()}var l=s.position.x-.5*i.options.width,c=s.position.y-.2*i.options.height,d=Math.abs(l)+Math.abs(c);o.shadowColor="rgba(0,0,0,0.15)",o.shadowOffsetX=.05*l,o.shadowOffsetY=.05*c,o.shadowBlur=1+12*Math.min(1,d/1e3),o.fill(),o.shadowColor=null,o.shadowOffsetX=null,o.shadowOffsetY=null,o.shadowBlur=null}}},B.bodies=function(e,t,n){var i,r,s,a=n,l=e.render,c=l.options;for(s=0;s<t.length;s++)if(i=t[s],i.render.visible)for(k=i.parts.length>1?1:0;k<i.parts.length;k++)if(r=i.parts[k],r.render.sprite&&r.render.sprite.texture&&!c.wireframes){var d=r.render.sprite,u=o(l,d.texture);c.showSleeping&&i.isSleeping&&(a.globalAlpha=.5),a.translate(r.position.x,r.position.y),a.rotate(r.angle),a.drawImage(u,u.width*-.5*d.xScale,u.height*-.5*d.yScale,u.width*d.xScale,u.height*d.yScale),a.rotate(-r.angle),a.translate(-r.position.x,-r.position.y),c.showSleeping&&i.isSleeping&&(a.globalAlpha=1)}else{if(r.circleRadius)a.beginPath(),a.arc(r.position.x,r.position.y,r.circleRadius,0,2*Math.PI);else{a.beginPath(),a.moveTo(r.vertices[0].x,r.vertices[0].y);for(var p=1;p<r.vertices.length;p++)a.lineTo(r.vertices[p].x,r.vertices[p].y);a.closePath()}c.wireframes?(a.lineWidth=1,a.strokeStyle="#bbb",c.showSleeping&&i.isSleeping&&(a.strokeStyle="rgba(255,255,255,0.2)"),a.stroke()):(a.fillStyle=c.showSleeping&&i.isSleeping?f.shadeColor(r.render.fillStyle,50):r.render.fillStyle,a.lineWidth=r.render.lineWidth,a.strokeStyle=r.render.strokeStyle,a.fill(),a.stroke())}},B.bodyWireframes=function(e,t,n){var o,i,r,s,a,l=n,c=e.render.options.showInternalEdges;for(l.beginPath(),r=0;r<t.length;r++)if(o=t[r],o.render.visible)for(a=o.parts.length>1?1:0;a<o.parts.length;a++){for(i=o.parts[a],l.moveTo(i.vertices[0].x,i.vertices[0].y),s=1;s<i.vertices.length;s++)!i.vertices[s-1].isInternal||c?l.lineTo(i.vertices[s].x,i.vertices[s].y):l.moveTo(i.vertices[s].x,i.vertices[s].y),i.vertices[s].isInternal&&!c&&l.moveTo(i.vertices[(s+1)%i.vertices.length].x,i.vertices[(s+1)%i.vertices.length].y);l.lineTo(i.vertices[0].x,i.vertices[0].y)}l.lineWidth=1,l.strokeStyle="#bbb",l.stroke()},B.bodyConvexHulls=function(e,t,n){var o,i,r,s=n;for(s.beginPath(),i=0;i<t.length;i++)if(o=t[i],o.render.visible&&1!==o.parts.length){for(s.moveTo(o.vertices[0].x,o.vertices[0].y),r=1;r<o.vertices.length;r++)s.lineTo(o.vertices[r].x,o.vertices[r].y);s.lineTo(o.vertices[0].x,o.vertices[0].y)}s.lineWidth=1,s.strokeStyle="rgba(255,255,255,0.2)",s.stroke()},B.vertexNumbers=function(e,t,n){var o,i,r,s=n;for(o=0;o<t.length;o++){var a=t[o].parts;for(r=a.length>1?1:0;r<a.length;r++){var l=a[r];for(i=0;i<l.vertices.length;i++)s.fillStyle="rgba(255,255,255,0.2)",s.fillText(o+"_"+i,l.position.x+.8*(l.vertices[i].x-l.position.x),l.position.y+.8*(l.vertices[i].y-l.position.y))}}},B.bodyBounds=function(e,t,n){var o=n,i=e.render,r=i.options;o.beginPath();for(var s=0;s<t.length;s++){var a=t[s];if(a.render.visible)for(var l=t[s].parts,c=l.length>1?1:0;c<l.length;c++){var d=l[c];o.rect(d.bounds.min.x,d.bounds.min.y,d.bounds.max.x-d.bounds.min.x,d.bounds.max.y-d.bounds.min.y)}}o.strokeStyle=r.wireframes?"rgba(255,255,255,0.08)":"rgba(0,0,0,0.1)",o.lineWidth=1,o.stroke()},B.bodyAxes=function(e,t,n){var o,i,r,s,a=n,l=e.render,c=l.options;for(a.beginPath(),i=0;i<t.length;i++){var d=t[i],u=d.parts;if(d.render.visible)if(c.showAxes)for(r=u.length>1?1:0;r<u.length;r++)for(o=u[r],s=0;s<o.axes.length;s++){var p=o.axes[s];a.moveTo(o.position.x,o.position.y),a.lineTo(o.position.x+20*p.x,o.position.y+20*p.y)}else for(r=u.length>1?1:0;r<u.length;r++)for(o=u[r],s=0;s<o.axes.length;s++)a.moveTo(o.position.x,o.position.y),a.lineTo((o.vertices[0].x+o.vertices[o.vertices.length-1].x)/2,(o.vertices[0].y+o.vertices[o.vertices.length-1].y)/2)}a.strokeStyle=c.wireframes?"indianred":"rgba(0,0,0,0.3)",a.lineWidth=1,a.stroke()},B.bodyPositions=function(e,t,n){var o,i,r,s=n,a=e.render,l=a.options;for(s.beginPath(),r=0;r<t.length;r++)if(o=t[r],o.render.visible)for(k=0;k<o.parts.length;k++)i=o.parts[k],s.arc(i.position.x,i.position.y,3,0,2*Math.PI,!1),s.closePath();for(s.fillStyle=l.wireframes?"indianred":"rgba(0,0,0,0.5)",s.fill(),s.beginPath(),r=0;r<t.length;r++)o=t[r],o.render.visible&&(s.arc(o.positionPrev.x,o.positionPrev.y,2,0,2*Math.PI,!1),s.closePath());s.fillStyle="rgba(255,165,0,0.8)",s.fill()},B.bodyVelocity=function(e,t,n){var o=n;o.beginPath();for(var i=0;i<t.length;i++){var r=t[i];r.render.visible&&(o.moveTo(r.position.x,r.position.y),o.lineTo(r.position.x+2*(r.position.x-r.positionPrev.x),r.position.y+2*(r.position.y-r.positionPrev.y)))}o.lineWidth=3,o.strokeStyle="cornflowerblue",o.stroke()},B.bodyIds=function(e,t,n){var o,i,r=n;for(o=0;o<t.length;o++)if(t[o].render.visible){var s=t[o].parts;for(i=s.length>1?1:0;i<s.length;i++){var a=s[i];r.font="12px Arial",r.fillStyle="rgba(255,255,255,0.5)",r.fillText(a.id,a.position.x+10,a.position.y-10)}}},B.collisions=function(e,t,n){var o,i,r,s,a=n,l=e.render.options;for(a.beginPath(),r=0;r<t.length;r++)if(o=t[r],o.isActive)for(i=o.collision,s=0;s<o.activeContacts.length;s++){var c=o.activeContacts[s],d=c.vertex;a.rect(d.x-1.5,d.y-1.5,3.5,3.5)}for(a.fillStyle=l.wireframes?"rgba(255,255,255,0.7)":"orange",a.fill(),a.beginPath(),r=0;r<t.length;r++)if(o=t[r],o.isActive&&(i=o.collision,o.activeContacts.length>0)){var u=o.activeContacts[0].vertex.x,p=o.activeContacts[0].vertex.y;2===o.activeContacts.length&&(u=(o.activeContacts[0].vertex.x+o.activeContacts[1].vertex.x)/2,p=(o.activeContacts[0].vertex.y+o.activeContacts[1].vertex.y)/2),i.bodyB===i.supports[0].body||i.bodyA.isStatic===!0?a.moveTo(u-8*i.normal.x,p-8*i.normal.y):a.moveTo(u+8*i.normal.x,p+8*i.normal.y),a.lineTo(u,p)}a.strokeStyle=l.wireframes?"rgba(255,165,0,0.7)":"orange",a.lineWidth=1,a.stroke()},B.separations=function(e,t,n){var o,i,r,s,a,l=n,c=e.render.options;for(l.beginPath(),a=0;a<t.length;a++)if(o=t[a],o.isActive){i=o.collision,r=i.bodyA,s=i.bodyB;var d=1;s.isStatic||r.isStatic||(d=.5),s.isStatic&&(d=0),l.moveTo(s.position.x,s.position.y),l.lineTo(s.position.x-i.penetration.x*d,s.position.y-i.penetration.y*d),d=1,s.isStatic||r.isStatic||(d=.5),r.isStatic&&(d=0),l.moveTo(r.position.x,r.position.y),l.lineTo(r.position.x+i.penetration.x*d,r.position.y+i.penetration.y*d)}l.strokeStyle=c.wireframes?"rgba(255,165,0,0.5)":"orange",l.stroke()},B.grid=function(e,t,n){var o=n,i=e.render.options;o.strokeStyle=i.wireframes?"rgba(255,180,0,0.1)":"rgba(255,180,0,0.5)",o.beginPath();for(var r=f.keys(t.buckets),s=0;s<r.length;s++){var a=r[s];if(!(t.buckets[a].length<2)){var l=a.split(",");o.rect(.5+parseInt(l[0],10)*t.bucketWidth,.5+parseInt(l[1],10)*t.bucketHeight,t.bucketWidth,t.bucketHeight)}}o.lineWidth=1,o.stroke()},B.inspector=function(e,t){var n,o=e.engine,i=e.selected,r=o.render,s=r.options;if(s.hasBounds){var a=r.bounds.max.x-r.bounds.min.x,l=r.bounds.max.y-r.bounds.min.y,c=a/r.options.width,d=l/r.options.height;t.scale(1/c,1/d),t.translate(-r.bounds.min.x,-r.bounds.min.y)}for(var u=0;u<i.length;u++){var p=i[u].data;switch(t.translate(.5,.5),t.lineWidth=1,t.strokeStyle="rgba(255,165,0,0.9)",t.setLineDash([1,2]),p.type){case"body":n=p.bounds,t.beginPath(),t.rect(Math.floor(n.min.x-3),Math.floor(n.min.y-3),Math.floor(n.max.x-n.min.x+6),Math.floor(n.max.y-n.min.y+6)),t.closePath(),t.stroke();break;case"constraint":var v=p.pointA;p.bodyA&&(v=p.pointB),t.beginPath(),t.arc(v.x,v.y,10,0,2*Math.PI),t.closePath(),t.stroke()}t.setLineDash([0]),t.translate(-.5,-.5)}null!==e.selectStart&&(t.translate(.5,.5),t.lineWidth=1,t.strokeStyle="rgba(255,165,0,0.6)",t.fillStyle="rgba(255,165,0,0.1)",n=e.selectBounds,t.beginPath(),t.rect(Math.floor(n.min.x),Math.floor(n.min.y),Math.floor(n.max.x-n.min.x),Math.floor(n.max.y-n.min.y)),t.closePath(),t.stroke(),t.fill(),t.translate(-.5,-.5)),s.hasBounds&&t.setTransform(1,0,0,1,0,0)};var e=function(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n.oncontextmenu=function(){return!1},n.onselectstart=function(){return!1},n},t=function(e){var t=e.getContext("2d"),n=window.devicePixelRatio||1,o=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return n/o},o=function(e,t){var n=e.textures[t];return n?n:(n=e.textures[t]=new Image,n.src=t,n)},i=function(e,t){var n=t;/(jpg|gif|png)$/.test(t)&&(n="url("+t+")"),e.canvas.style.background=n,e.canvas.style.backgroundSize="contain",e.currentBackground=t}}();var I={};!function(){I.create=function(e){var t={controller:I,element:null,canvas:null,options:{width:800,height:600,background:"#fafafa",wireframeBackground:"#222",hasBounds:!1,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1}},n=f.extend(t,e),o=!n.options.wireframes&&"transparent"===n.options.background;return n.context=new PIXI.WebGLRenderer(n.options.width,n.options.height,{view:n.canvas,transparent:o,antialias:!0,backgroundColor:e.background}),n.canvas=n.context.view,n.container=new PIXI.Container,n.bounds=n.bounds||{min:{x:0,y:0},max:{x:n.options.width,y:n.options.height}},n.textures={},n.sprites={},n.primitives={},n.spriteContainer=new PIXI.Container,n.container.addChild(n.spriteContainer),f.isElement(n.element)?n.element.appendChild(n.canvas):f.log('No "render.element" passed, "render.canvas" was not inserted into document.',"warn"),n.canvas.oncontextmenu=function(){return!1},n.canvas.onselectstart=function(){return!1},n},I.clear=function(e){for(var t=e.container,n=e.spriteContainer;t.children[0];)t.removeChild(t.children[0]);for(;n.children[0];)n.removeChild(n.children[0]);var o=e.sprites["bg-0"];e.textures={},e.sprites={},e.primitives={},e.sprites["bg-0"]=o,o&&t.addChildAt(o,0),e.container.addChild(e.spriteContainer),e.currentBackground=null,t.scale.set(1,1),t.position.set(0,0)},I.setBackground=function(e,t){if(e.currentBackground!==t){var n=t.indexOf&&-1!==t.indexOf("#"),i=e.sprites["bg-0"];if(n){var r=f.colorToNumber(t);e.context.backgroundColor=r,i&&e.container.removeChild(i)}else if(!i){var s=o(e,t);i=e.sprites["bg-0"]=new PIXI.Sprite(s),i.position.x=0,i.position.y=0,e.container.addChildAt(i,0)}e.currentBackground=t}},I.world=function(e){var t,o=e.render,i=e.world,r=o.context,s=o.container,a=o.options,l=n.allBodies(i),c=n.allConstraints(i),d=[];a.wireframes?I.setBackground(o,a.wireframeBackground):I.setBackground(o,a.background);var u=o.bounds.max.x-o.bounds.min.x,p=o.bounds.max.y-o.bounds.min.y,v=u/o.options.width,f=p/o.options.height;if(a.hasBounds){for(t=0;t<l.length;t++){var y=l[t];y.render.sprite.visible=A.overlaps(y.bounds,o.bounds)}for(t=0;t<c.length;t++){var m=c[t],g=m.bodyA,x=m.bodyB,h=m.pointA,b=m.pointB;g&&(h=M.add(g.position,m.pointA)),x&&(b=M.add(x.position,m.pointB)),h&&b&&(A.contains(o.bounds,h)||A.contains(o.bounds,b))&&d.push(m)}s.scale.set(1/v,1/f),s.position.set(-o.bounds.min.x*(1/v),-o.bounds.min.y*(1/f))}else d=c;for(t=0;t<l.length;t++)I.body(e,l[t]);for(t=0;t<d.length;t++)I.constraint(e,d[t]);r.render(s)},I.constraint=function(e,t){var n=e.render,o=t.bodyA,i=t.bodyB,r=t.pointA,s=t.pointB,a=n.container,l=t.render,c="c-"+t.id,d=n.primitives[c];return d||(d=n.primitives[c]=new PIXI.Graphics),l.visible&&t.pointA&&t.pointB?(-1===f.indexOf(a.children,d)&&a.addChild(d),d.clear(),d.beginFill(0,0),d.lineStyle(l.lineWidth,f.colorToNumber(l.strokeStyle),1),o?d.moveTo(o.position.x+r.x,o.position.y+r.y):d.moveTo(r.x,r.y),i?d.lineTo(i.position.x+s.x,i.position.y+s.y):d.lineTo(s.x,s.y),void d.endFill()):void d.clear()},I.body=function(n,o){var i=n.render,r=o.render;if(r.visible)if(r.sprite&&r.sprite.texture){var s="b-"+o.id,a=i.sprites[s],l=i.spriteContainer;a||(a=i.sprites[s]=e(i,o)),-1===f.indexOf(l.children,a)&&l.addChild(a),a.position.x=o.position.x,a.position.y=o.position.y,a.rotation=o.angle,a.scale.x=r.sprite.xScale||1,a.scale.y=r.sprite.yScale||1}else{var c="b-"+o.id,d=i.primitives[c],u=i.container;d||(d=i.primitives[c]=t(i,o),d.initialAngle=o.angle),-1===f.indexOf(u.children,d)&&u.addChild(d),d.position.x=o.position.x,d.position.y=o.position.y,d.rotation=o.angle-d.initialAngle
}};var e=function(e,t){var n=t.render,i=n.sprite.texture,r=o(e,i),s=new PIXI.Sprite(r);return s.anchor.x=.5,s.anchor.y=.5,s},t=function(e,t){var n,o=t.render,i=e.options,r=new PIXI.Graphics,s=f.colorToNumber(o.fillStyle),a=f.colorToNumber(o.strokeStyle),l=f.colorToNumber(o.strokeStyle),c=f.colorToNumber("#bbb"),d=f.colorToNumber("#CD5C5C");r.clear();for(var u=t.parts.length>1?1:0;u<t.parts.length;u++){n=t.parts[u],i.wireframes?(r.beginFill(0,0),r.lineStyle(1,c,1)):(r.beginFill(s,1),r.lineStyle(o.lineWidth,a,1)),r.moveTo(n.vertices[0].x-t.position.x,n.vertices[0].y-t.position.y);for(var p=1;p<n.vertices.length;p++)r.lineTo(n.vertices[p].x-t.position.x,n.vertices[p].y-t.position.y);r.lineTo(n.vertices[0].x-t.position.x,n.vertices[0].y-t.position.y),r.endFill(),(i.showAngleIndicator||i.showAxes)&&(r.beginFill(0,0),i.wireframes?r.lineStyle(1,d,1):r.lineStyle(1,l),r.moveTo(n.position.x-t.position.x,n.position.y-t.position.y),r.lineTo((n.vertices[0].x+n.vertices[n.vertices.length-1].x)/2-t.position.x,(n.vertices[0].y+n.vertices[n.vertices.length-1].y)/2-t.position.y),r.endFill())}return r},o=function(e,t){var n=e.textures[t];return n||(n=e.textures[t]=PIXI.Texture.fromImage(t)),n}}(),o.add=n.add,o.remove=n.remove,o.addComposite=n.addComposite,o.addBody=n.addBody,o.addConstraint=n.addConstraint,o.clear=n.clear,y.run=x.run,e.Body=t,e.Composite=n,e.World=o,e.Contact=i,e.Detector=r,e.Grid=s,e.Pairs=l,e.Pair=a,e.Resolver=d,e.SAT=u,e.Constraint=p,e.MouseConstraint=v,e.Common=f,e.Engine=y,e.Mouse=g,e.Sleeping=h,e.Bodies=b,e.Composites=S,e.Axes=w,e.Bounds=A,e.Vector=M,e.Vertices=P,e.Render=B,e.RenderPixi=I,e.Events=m,e.Query=c,e.Runner=x,e.Svg=C,"undefined"!=typeof exports&&("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.Matter=e),"function"==typeof define&&define.amd&&define("Matter",[],function(){return e}),"object"==typeof window&&"object"==typeof window.document&&(window.Matter=e)}();